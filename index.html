<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Magic Scratch Card</title>
  <style>
    /* Reset & Body */
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #1a1f36;
      font-family: 'Verdana', sans-serif;
      color: #f0f0f0;
    }
    .container {
      width: 100%; max-width: 460px;
      padding: 20px;
      text-align: center;
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 8px;
      background: linear-gradient(90deg, #ff9a9e, #fad0c4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    p.subtitle {
      font-size: 1rem;
      margin-bottom: 20px;
      opacity: 0.8;
    }
    /* Input Form */
    .form-box {
      background: #2e324b;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      display: grid; gap:12px;
      margin-bottom: 20px;
    }
    .form-box input,
    .form-box textarea {
      width: 100%;
      padding: 10px;
      font-size: 0.95rem;
      border: 1px solid #444862;
      border-radius: 6px;
      background: #272b45;
      color: #e0e0e0;
      outline: none;
    }
    .form-box button {
      padding: 12px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background: #ff9a9e;
      color: #1a1f36;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .form-box button:hover {
      transform: scale(1.03);
    }
    /* Link Box */
    .link-box {
      background: #2e324b;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      margin-bottom: 20px;
      display: none;
    }
    .link-box p {
      margin-bottom: 8px;
      font-weight: bold;
    }
    .link-box input {
      width: calc(100% - 20px);
      padding: 8px;
      border: 1px solid #444862;
      border-radius: 6px;
      background: #272b45;
      color: #e0e0e0;
      margin-bottom: 10px;
    }
    .link-box .actions {
      display: flex; justify-content: space-between; gap:8px;
    }
    .link-box .actions button {
      flex:1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      background: #fad0c4;
      color: #1a1f36;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .link-box .actions button:hover {
      opacity: 0.8;
    }
    /* Card */
    .card {
      position: relative;
      width: 100%; aspect-ratio:4/3;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      display: none;
    }
    .card::before {
      content:'';
      position:absolute; inset:0;
      background: radial-gradient(circle at top left, #567df4, #2c3e50);
      z-index:0;
    }
    .card-content {
      position: relative; z-index:1;
      padding: 24px;
      text-align: center;
    }
    .card-content h2 {
      font-size: 1.6rem;
      margin-bottom: 12px;
    }
    .card-content p {
      font-size: 1rem;
      line-height:1.4;
    }
    #scratch {
      position:absolute; inset:0;
      z-index:2;
      cursor: crosshair;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Magic Scratch Card</h1>
  <p class="subtitle">Заховайте таємницю та здивуйте друзів!</p>

  <div class="form-box" id="formBox">
    <input type="text" id="titleInput" placeholder="Заголовок" />
    <textarea id="msgInput" rows="3" placeholder="Ваш секретний текст..."></textarea>
    <button id="makeBtn">Створити</button>
  </div>

  <div class="link-box" id="linkBox">
    <p>Готово! Поділіться цим посиланням:</p>
    <input type="text" id="linkInput" readonly />
    <div class="actions">
      <button id="copyLink">Копіювати</button>
      <button id="viewLink">Переглянути</button>
    </div>
  </div>

  <div class="card" id="cardBox">
    <div class="card-content">
      <h2 id="cardTitle">Hello!</h2>
      <p id="cardMsg">Scratch to reveal your surprise!</p>
    </div>
    <canvas id="scratch"></canvas>
  </div>
</div>

<script>
  const formBox = document.getElementById('formBox');
  const linkBox = document.getElementById('linkBox');
  const cardBox = document.getElementById('cardBox');
  const titleInput = document.getElementById('titleInput');
  const msgInput = document.getElementById('msgInput');
  const makeBtn = document.getElementById('makeBtn');
  const linkInput = document.getElementById('linkInput');
  const copyLink = document.getElementById('copyLink');
  const viewLink = document.getElementById('viewLink');
  const cardTitle = document.getElementById('cardTitle');
  const cardMsg = document.getElementById('cardMsg');

  function parseParams() {
    const p = new URLSearchParams(window.location.search);
    return { t: p.get('t'), m: p.get('m') };
  }
  const { t, m } = parseParams();

  if (t && m) {
    formBox.style.display = 'none';
    linkBox.style.display = 'none';
    cardBox.style.display = 'block';
    cardTitle.textContent = decodeURIComponent(t);
    cardMsg.textContent = decodeURIComponent(m);
    setupScratch();
  } else {
    makeBtn.onclick = () => {
      const tt = encodeURIComponent(titleInput.value.trim());
      const mm = encodeURIComponent(msgInput.value.trim());
      if (!tt || !mm) return;
      const u = new URL(window.location.href);
      u.searchParams.set('t', tt);
      u.searchParams.set('m', mm);
      linkInput.value = u.toString();
      linkBox.style.display = 'block';
    };
    copyLink.onclick = () => { linkInput.select(); document.execCommand('copy'); };
    viewLink.onclick = () => window.open(linkInput.value, '_blank');
  }

  function setupScratch() {
    const canvas = document.getElementById('scratch');
    const ctx = canvas.getContext('2d');
    let scratching = false;
    function resize() {
      const rect = cardBox.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;
      ctx.fillStyle = '#b0b0b0';
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }
    window.addEventListener('resize', resize);
    resize();
    canvas.onmousedown = () => scratching = true;
    canvas.onmouseup = () => scratching = false;
    canvas.onmousemove = e => {
      if (!scratching) return;
      const r = canvas.getBoundingClientRect();
      const x = e.clientX - r.left;
      const y = e.clientY - r.top;
      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath(); ctx.arc(x,y,25,0,2*Math.PI); ctx.fill();
      ctx.globalCompositeOperation = 'source-over';
    };
  }
</script>
</body>
</html>
